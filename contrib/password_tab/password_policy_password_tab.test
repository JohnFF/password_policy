<?php
/**
 * @file
 * Web tests for Password policy password tab module.
 *
 * @ignore sniffer_squiz_scope_methodscope_missing:file
 */

/**
 * Tests of password tab.
 */
class PasswordPolicyPasswordTabTest extends DrupalWebTestCase {
  /**
   * Get info about the test case.
   */
  public static function getInfo() {
    return array(
      'name' => 'Password tab test',
      'description' => t('Assure that password change tab works.'),
      'group' => 'Password Policy',
    );
  }

  /**
   * Set up the test.
   */
  public function setUp() {
    parent::setUp('password_policy', 'password_policy_password_tab');
    $this->user = $this->drupalCreateUser();
  }

  /**
   * Test the password tab.
   */
  function testPasswordTab() {
    $this->drupalLogin($this->user);

    // Check tab is working.
    $this->drupalGet('user/' . $this->user->uid . '/password');

    // Attempt password change.
    $edit = array(
      'current_pass' => $this->user->pass_raw,
      'pass[pass1]' => $this->user->pass_raw . $this->user->pass_raw,
      'pass[pass2]' => $this->user->pass_raw . $this->user->pass_raw,
    );
    $this->drupalPost('user/' . $this->user->uid . '/password', $edit, 'Save');
    $this->assertText(t('Password has been changed.'));
  }
}
